<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blue Prince Spoiler Free Guide & Tracking</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
      [x-cloak] {
        display: none !important;
      }
      .checkbox-reveal {
        animation: slideDown 0.3s ease-out;
      }
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .section-reveal {
        animation: fadeIn 0.5s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Dynamic checkbox colors */
      .checkbox-colored {
        accent-color: var(--checkbox-color);
      }

      /* Dynamic swiper button colors and positioning */
      .swiper-button-next,
      .swiper-button-prev {
        color: var(--swiper-color) !important;
        top: calc(50% - 30px) !important;
        transform: translateY(-50%) !important;
        margin-top: 0 !important;
        height: 44px !important;
        width: 44px !important;
      }

      /* Override Swiper's default positioning to center on image */
      .swiper-button-next::after,
      .swiper-button-prev::after {
        font-size: 18px !important;
      }

      /* Dynamic swiper pagination colors */
      .swiper-pagination-bullet-active {
        background-color: var(--swiper-color) !important;
      }

      /* Match single image spacing for carousel */
      .swiper-pagination {
        position: static !important;
        margin-top: 8px !important;
        margin-bottom: 0px !important;
      }

      /* Screen reader only content */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Focus visible styles for better keyboard navigation */
      .focus-visible:focus {
        outline: 2px solid #3B82F6;
        outline-offset: 2px;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .border-gray-200 {
          border-color: #000;
        }
        .text-gray-600 {
          color: #000;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Live region for screen reader announcements -->
    <div id="live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <div
      x-data="checklistApp()"
      x-cloak
      class="container mx-auto px-4 py-6 max-w-4xl"
    >
      <!-- Mystery Message Container -->
      <div 
        class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2 items-end"
        aria-live="polite"
        aria-atomic="false"
      >
        <template x-for="msg in mysteryMessages" :key="msg.id">
          <div
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-y-2"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 transform translate-y-0"
            x-transition:leave-end="opacity-0 transform translate-y-2"
            :class="msg.isSuccess ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700'"
            class="px-4 py-3 rounded-lg shadow-md border max-w-md"
          >
            <div class="flex items-center">
              <svg 
                class="w-5 h-5 mr-2" 
                :class="msg.isSuccess ? 'text-green-500' : 'text-red-500'"
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  :d="msg.isSuccess ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z'"
                ></path>
              </svg>
              <span x-text="msg.message"></span>
            </div>
          </div>
        </template>
      </div>
        <!-- Header -->
        <header class="mb-8" role="banner">
          <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
              Blue Prince Spoiler Free Guide & Tracking
            </h1>
            <p class="text-gray-600">
              Mark items complete to track your progress.
            </p>
            <p class="text-xs text-gray-400 mt-1" x-text="`Version ${version}`">
              Version 0.11.0
            </p>
          </div>
          
          <!-- Action Buttons -->
          <div class="flex justify-between mt-4 w-full" role="toolbar" aria-label="Application controls">
            <!-- Expand/Collapse All Buttons (Left-aligned) -->
            <div class="flex space-x-3">
              <button
                @click="expandAllSections()"
                @keydown.enter="expandAllSections()"
                @keydown.space.prevent="expandAllSections()"
                class="px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 hover:border-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                aria-label="Expand all sections"
              >
                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
                Expand All
              </button>
              <button
                @click="collapseAllSections()"
                @keydown.enter="collapseAllSections()"
                @keydown.space.prevent="collapseAllSections()"
                class="px-4 py-2 text-sm font-medium text-blue-600 bg-white border border-blue-300 rounded-md hover:bg-blue-50 hover:border-blue-400 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                aria-label="Collapse all sections"
              >
                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
                Collapse All
              </button>
            </div>
            
            <!-- Complete/Reset Buttons (Right-aligned) -->
            <div class="flex space-x-3">
              <button
                @click="showCompleteAllConfirm = true"
                @keydown.enter="showCompleteAllConfirm = true"
                @keydown.space.prevent="showCompleteAllConfirm = true"
                class="px-4 py-2 text-sm font-medium text-orange-600 bg-white border border-orange-300 rounded-md hover:bg-orange-50 hover:border-orange-400 transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2"
                aria-label="Complete all items and reveal all content including spoilers"
                aria-describedby="complete-all-warning"
              >
                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Complete All (Spoilers!)
              </button>
              <div id="complete-all-warning" class="sr-only">Warning: This action will reveal all spoilers and secrets</div>
              <button
                @click="showResetConfirm = true"
                @keydown.enter="showResetConfirm = true"
                @keydown.space.prevent="showResetConfirm = true"
                class="px-4 py-2 text-sm font-medium text-red-600 bg-white border border-red-300 rounded-md hover:bg-red-50 hover:border-red-400 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                aria-label="Reset all progress and clear all completed items"
                aria-describedby="reset-warning"
              >
                <svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Reset All Progress
              </button>
              <div id="reset-warning" class="sr-only">Warning: This action will permanently delete all progress</div>
            </div>
          </div>
        </header>

        <!-- Reset Confirmation Modal -->
        <div 
          x-show="showResetConfirm"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
          @click.self="showResetConfirm = false"
          @keydown.escape="showResetConfirm = false"
          x-trap="showResetConfirm"
          role="dialog"
          aria-modal="true"
          aria-labelledby="reset-modal-title"
          aria-describedby="reset-modal-description"
        >
          <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform scale-95"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-95"
          >
            <div class="flex items-center mb-4">
              <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
              <h3 id="reset-modal-title" class="text-lg font-semibold text-gray-900">Reset All Progress</h3>
            </div>
            
            <p id="reset-modal-description" class="text-gray-600 mb-6">
              Are you sure you want to reset all progress? This will:
            </p>
            
            <ul class="text-sm text-gray-600 mb-6 space-y-1" role="list">
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                Uncheck all completed items
              </li>
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                Hide all unlocked additions
              </li>
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                Collapse all expanded sections
              </li>
            </ul>
            
            <p class="text-sm text-gray-500 mb-6">
              <strong>This action cannot be undone.</strong>
            </p>
            
            <div class="flex space-x-3" role="group" aria-label="Reset confirmation actions">
              <button
                @click="showResetConfirm = false"
                @keydown.enter="showResetConfirm = false"
                @keydown.space.prevent="showResetConfirm = false"
                class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
                aria-label="Cancel reset operation"
              >
                Cancel
              </button>
              <button
                @click="resetAllProgress(); showResetConfirm = false"
                @keydown.enter="resetAllProgress(); showResetConfirm = false"
                @keydown.space.prevent="resetAllProgress(); showResetConfirm = false"
                class="flex-1 px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                aria-label="Confirm reset all progress - this will permanently delete all progress"
              >
                Reset Everything
              </button>
            </div>
          </div>
        </div>

        <!-- Complete All Confirmation Modal -->
        <div 
          x-show="showCompleteAllConfirm"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
          @click.self="showCompleteAllConfirm = false"
          @keydown.escape="showCompleteAllConfirm = false"
          x-trap="showCompleteAllConfirm"
          role="dialog"
          aria-modal="true"
          aria-labelledby="complete-all-modal-title"
          aria-describedby="complete-all-modal-description"
        >
          <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform scale-95"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-95"
          >
            <div class="flex items-center mb-4">
              <svg class="w-6 h-6 text-orange-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
              <h3 id="complete-all-modal-title" class="text-lg font-semibold text-gray-900">Complete All Progress</h3>
            </div>
            
            <div class="mb-4 p-3 bg-orange-50 border border-orange-200 rounded-md">
              <div class="flex items-center">
                <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <span class="text-sm font-medium text-orange-800">⚠️ SPOILER WARNING ⚠️</span>
              </div>
            </div>
            
            <p id="complete-all-modal-description" class="text-gray-600 mb-6">
              This will instantly complete everything and reveal all secrets! This action will:
            </p>
            
            <ul class="text-sm text-gray-600 mb-6 space-y-1" role="list">
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Check all items as completed
              </li>
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Unlock and reveal ALL mystery content
              </li>
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Expand all sections for full visibility
              </li>
              <li class="flex items-center" role="listitem">
                <svg class="w-4 h-4 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Show all images and descriptions
              </li>
            </ul>
            
            <p class="text-sm text-orange-600 mb-6">
              <strong>This will spoil all secrets and mysteries!</strong> Only use this if you want to see everything at once or need to reference completed content.
            </p>
            
            <div class="flex space-x-3" role="group" aria-label="Complete all confirmation actions">
              <button
                @click="showCompleteAllConfirm = false"
                @keydown.enter="showCompleteAllConfirm = false"
                @keydown.space.prevent="showCompleteAllConfirm = false"
                class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
                aria-label="Cancel complete all operation"
              >
                Cancel
              </button>
              <button
                @click="completeAllProgress(); showCompleteAllConfirm = false"
                @keydown.enter="completeAllProgress(); showCompleteAllConfirm = false"
                @keydown.space.prevent="completeAllProgress(); showCompleteAllConfirm = false"
                class="flex-1 px-4 py-2 text-sm font-medium text-white bg-orange-600 border border-transparent rounded-md hover:bg-orange-700 transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2"
                aria-label="Confirm complete all progress - this will reveal all spoilers and secrets"
              >
                Complete All (Spoilers!)
              </button>
            </div>
          </div>
        </div>

        <!-- Data Load Error Message -->
        <div x-show="dataLoadError" class="mb-6 bg-red-50 border border-red-200 rounded-lg p-6 text-center">
          <div class="flex items-center justify-center mb-4">
            <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-red-800 mb-2">Unable to Load Data</h2>
          <p class="text-red-700 mb-4">
            The checklist data could not be loaded from <code class="bg-red-100 px-2 py-1 rounded">data.js</code>.
          </p>
          <p class="text-red-600 text-sm">
            Please check that the <code class="bg-red-100 px-1 rounded">data</code> file exists and contains valid data.
          </p>
        </div>

        <!-- Navigation Panel -->
        <div x-show="!dataLoadError" class="fixed top-4 left-4 z-40">
          <!-- Navigation Toggle Button -->
          <button
            @click="toggleNavigation()"
            @keydown.enter="toggleNavigation()"
            @keydown.space.prevent="toggleNavigation()"
            class="bg-blue-600 text-white p-3 rounded-lg shadow-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            aria-label="Toggle navigation menu"
            :aria-expanded="showNavigation"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>

          <!-- Navigation Panel -->
          <div
            x-show="showNavigation"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform -translate-x-full"
            x-transition:enter-end="opacity-100 transform translate-x-0"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform translate-x-0"
            x-transition:leave-end="opacity-0 transform -translate-x-full"
            class="mt-2 bg-white rounded-lg shadow-xl border border-gray-200 w-80 max-h-96 overflow-y-auto"
            role="navigation"
            aria-label="Section navigation"
          >
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">Navigation</h3>
              
              <!-- Navigation Items -->
              <div class="space-y-2">
                <template x-for="section in getVisibleSections()" :key="section.id">
                  <div class="border border-gray-100 rounded-md overflow-hidden">
                    <!-- Section Navigation Item -->
                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 transition-colors">
                      <button
                        @click="scrollToSection(section.id)"
                        @keydown.enter="scrollToSection(section.id)"
                        @keydown.space.prevent="scrollToSection(section.id)"
                        class="flex-1 text-left text-sm font-medium text-gray-700 hover:text-blue-600 focus:outline-none focus:text-blue-600"
                        :class="currentActiveSection === section.id ? 'text-blue-600 font-semibold' : ''"
                        x-text="section.title"
                      ></button>
                      
                      <!-- Progress Indicator -->
                      <div class="flex items-center space-x-2 ml-2">
                        <span 
                          class="text-xs text-gray-500"
                          x-show="getSectionVisibleTotalCount(section.id) > 0"
                          x-text="`${Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100)}%`"
                        ></span>
                        
                        <!-- Accordion Toggle for Subsections -->
                        <button
                          x-show="getVisibleSubsections(section.id).length > 0"
                          @click="toggleNavSection(section.id)"
                          @keydown.enter="toggleNavSection(section.id)"
                          @keydown.space.prevent="toggleNavSection(section.id)"
                          class="p-1 hover:bg-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          :aria-expanded="expandedNavSections.includes(section.id)"
                          :aria-label="`Toggle ${section.title} subsections`"
                        >
                          <svg
                            class="w-4 h-4 transform transition-transform"
                            :class="expandedNavSections.includes(section.id) ? 'rotate-180' : ''"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                          >
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <!-- Subsections -->
                    <div
                      x-show="expandedNavSections.includes(section.id) && getVisibleSubsections(section.id).length > 0"
                      x-transition:enter="transition ease-out duration-200"
                      x-transition:enter-start="opacity-0 max-h-0"
                      x-transition:enter-end="opacity-100 max-h-96"
                      x-transition:leave="transition ease-in duration-150"
                      x-transition:leave-start="opacity-100 max-h-96"
                      x-transition:leave-end="opacity-0 max-h-0"
                      class="bg-gray-50 border-t border-gray-100"
                    >
                      <template x-for="subsection in getVisibleSubsections(section.id)" :key="subsection.id">
                        <div class="flex items-center justify-between p-2 pl-6 hover:bg-gray-100 transition-colors">
                          <button
                            @click="scrollToSubsection(subsection.id)"
                            @keydown.enter="scrollToSubsection(subsection.id)"
                            @keydown.space.prevent="scrollToSubsection(subsection.id)"
                            class="flex-1 text-left text-sm text-gray-600 hover:text-blue-600 focus:outline-none focus:text-blue-600"
                            x-text="subsection.title"
                          ></button>
                          
                          <!-- Subsection Progress -->
                          <span 
                            class="text-xs text-gray-400 ml-2"
                            x-show="getSubsectionVisibleTotalCount(subsection.id) > 0"
                            x-text="`${Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100)}%`"
                          ></span>
                        </div>
                      </template>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>

        <!-- Overall Progress -->
        <div x-show="!dataLoadError" class="mb-6 bg-white rounded-lg shadow-sm p-4" role="region" aria-labelledby="overall-progress-title">
          <div class="flex justify-between items-center mb-2">
            <span id="overall-progress-title" class="text-sm font-medium text-gray-700"
              >Overall Progress</span
            >
            <span
              class="text-sm text-gray-500"
              x-text="`${Math.round((getTotalChecked() / getTotalCheckboxes()) * 100)}%`"
              aria-label="Overall completion percentage"
            ></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2" role="progressbar" 
               :aria-valuenow="Math.round((getTotalChecked() / getTotalCheckboxes()) * 100)"
               aria-valuemin="0" 
               aria-valuemax="100"
               :aria-label="`Overall progress: ${Math.round((getTotalChecked() / getTotalCheckboxes()) * 100)}% complete`">
            <div
              class="h-2 rounded-full transition-all duration-300"
              :style="`width: ${(getTotalChecked() / getTotalCheckboxes()) * 100}%; background-color: ${getColorHex('blue')}`"
            ></div>
          </div>
        </div>

        <!-- Sections -->
        <div class="space-y-6">
          <template x-for="section in getVisibleSections()" :key="section.id">
            <div
              class="bg-white rounded-lg shadow-sm overflow-hidden section-reveal"
              :id="`section-${section.id}`"
            >
              <!-- Section Header -->
              <div
                class="bg-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset"
                @click="toggleSection(section.id)"
                @keydown="handleSectionKeydown($event, section.id)"
                tabindex="0"
                role="button"
                :aria-expanded="expandedSections.includes(section.id)"
                :aria-controls="`section-content-${section.id}`"
                :aria-label="`${section.title} section, ${expandedSections.includes(section.id) ? 'expanded' : 'collapsed'}. Progress: ${getSectionVisibleTotalCount(section.id) > 0 ? Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100) + '%' : 'No items'}`"
              >
                <div class="pl-4 pr-6 py-4 flex justify-between items-center">
                  <h2
                    class="text-xl font-semibold text-gray-800"
                    x-text="section.title"
                    :id="`section-title-${section.id}`"
                  ></h2>
                  <div class="flex items-center space-x-3">
                    <!-- Section Progress -->
                    <div class="text-sm text-gray-500" x-show="getSectionVisibleTotalCount(section.id) > 0">
                      <span
                        x-text="`${Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100)}%`"
                        :aria-label="`Section progress: ${Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100)}% complete`"
                      ></span>
                    </div>
                    <!-- Expand/Collapse Icon -->
                    <svg
                      class="w-5 h-5 transform transition-transform"
                      :class="expandedSections.includes(section.id) ? 'rotate-180' : ''"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      ></path>
                    </svg>
                  </div>
                </div>
                <!-- Section Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-1.5" 
                     role="progressbar" 
                     :aria-valuenow="getSectionVisibleTotalCount(section.id) === 0 ? 100 : Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100)"
                     aria-valuemin="0" 
                     aria-valuemax="100"
                     :aria-label="`${section.title} progress: ${getSectionVisibleTotalCount(section.id) === 0 ? 100 : Math.round((getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100)}% complete`">
                  <div
                    class="h-1.5 rounded-full transition-all duration-300"
                    :style="`width: ${getSectionVisibleTotalCount(section.id) === 0 ? 100 : (getSectionVisibleCheckedCount(section.id) / getSectionVisibleTotalCount(section.id)) * 100}%; background-color: ${getColorHex(section.color)}`"
                  ></div>
                </div>
              </div>

              <!-- Section Content -->
              <div
                x-show="expandedSections.includes(section.id)"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform scale-95"
                x-transition:enter-end="opacity-100 transform scale-100"
                class="p-4"
                :style="!section.subsections || section.subsections.length === 0 ? `background-color: ${getColorHex(section.color)}15` : ''"
              >
                <!-- Subsections -->
                <template
                  x-for="subsection in getVisibleSubsections(section.id)"
                  :key="subsection.id"
                >
                  <div
                    class="mb-6 last:mb-0 border border-gray-100 rounded-lg overflow-hidden"
                    :id="`subsection-${subsection.id}`"
                  >
                    <!-- Subsection Header -->
                    <div
                      class="bg-white cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset"
                      @click="toggleSubsection(subsection.id)"
                      @keydown="handleSubsectionKeydown($event, subsection.id)"
                      tabindex="0"
                      role="button"
                      :aria-expanded="expandedSubsections.includes(subsection.id)"
                      :aria-controls="`subsection-content-${subsection.id}`"
                      :aria-label="`${subsection.title} subsection, ${expandedSubsections.includes(subsection.id) ? 'expanded' : 'collapsed'}. Progress: ${getSubsectionVisibleTotalCount(subsection.id) > 0 ? Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100) + '%' : 'No items'}`"
                    >
                      <div
                        class="pl-4 pr-6 py-3 flex justify-between items-center"
                      >
                        <h3
                          class="text-lg font-medium text-gray-700"
                          x-text="subsection.title"
                          :id="`subsection-title-${subsection.id}`"
                        ></h3>
                        <div class="flex items-center space-x-3">
                          <!-- Subsection Progress Count -->
                          <div class="text-sm text-gray-500" x-show="getSubsectionVisibleTotalCount(subsection.id) > 0">
                            <span
                              x-text="`${Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100)}%`"
                              :aria-label="`Subsection progress: ${Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100)}% complete`"
                            ></span>
                          </div>
                          <!-- Expand/Collapse Icon -->
                          <svg
                            class="w-4 h-4 transform transition-transform"
                            :class="expandedSubsections.includes(subsection.id) ? 'rotate-180' : ''"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M19 9l-7 7-7-7"
                            ></path>
                          </svg>
                        </div>
                      </div>
                      <!-- Subsection Progress Bar -->
                      <div class="w-full bg-gray-200 rounded-full h-1" 
                           role="progressbar" 
                           :aria-valuenow="getSubsectionVisibleTotalCount(subsection.id) === 0 ? 100 : Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100)"
                           aria-valuemin="0" 
                           aria-valuemax="100"
                           :aria-label="`${subsection.title} progress: ${getSubsectionVisibleTotalCount(subsection.id) === 0 ? 100 : Math.round((getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100)}% complete`">
                        <div
                          class="h-1 rounded-full transition-all duration-300"
                          :style="`width: ${getSubsectionVisibleTotalCount(subsection.id) === 0 ? 100 : (getSubsectionVisibleCheckedCount(subsection.id) / getSubsectionVisibleTotalCount(subsection.id)) * 100}%; background-color: ${getColorHex(subsection.color)}`"
                        ></div>
                      </div>
                    </div>

                    <!-- Subsection Content -->
                    <div
                      x-show="expandedSubsections.includes(subsection.id)"
                      x-transition:enter="transition ease-out duration-200"
                      x-transition:enter-start="opacity-0 transform scale-95"
                      x-transition:enter-end="opacity-100 transform scale-100"
                      class="p-3"
                      :style="`background-color: ${getColorHex(subsection.color)}15`"
                    >
                      <!-- Information Items in Subsection -->
                      <template x-if="subsection.information && getVisibleInformation(subsection.information).length > 0">
                        <div class="space-y-3">
                          <template
                            x-for="informationId in getVisibleInformation(subsection.information)"
                            :key="informationId"
                          >
                            <div
                              class="checkbox-reveal"
                              x-data="{ information: data.information[informationId], informationId: informationId }"
                            >
                              <div
                                class="flex items-start space-x-3 p-3 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors bg-white"
                              >
                                <!-- Colored Bullet -->
                                <div 
                                  class="mt-1.5 w-2 h-2 rounded-full flex-shrink-0"
                                  :style="`background-color: ${getColorHex(subsection.color)}`"
                                ></div>

                                <!-- Content -->
                                <div class="flex-1 min-w-0">
                                  <h4
                                    class="block text-sm font-medium text-gray-900"
                                    x-text="information.title"
                                  ></h4>
                                  <p
                                    class="mt-1 text-sm text-gray-600"
                                    x-text="information.description"
                                  ></p>

                                  <!-- Images for Information Items -->
                                  <template
                                    x-if="information.images && information.images.length > 0"
                                  >
                                    <div class="mt-3">
                                      <template
                                        x-if="information.images.length === 1"
                                      >
                                        <div class="mt-2 text-center">
                                          <img
                                            :data-src="information.images[0].url"
                                            :alt="information.images[0].caption || information.title"
                                            class="max-w-full h-auto rounded-lg shadow-sm mx-auto"
                                            loading="lazy"
                                            width="400"
                                            height="225"
                                            style="
                                              max-height: 300px;
                                              object-fit: contain;
                                              opacity: 0;
                                              transition: opacity 0.3s ease;
                                              aspect-ratio: 16/9;
                                              background-color: #f3f4f6;
                                            "
                                            @load="$event.target.style.opacity='1'; console.log('Single info image loaded:', information.images[0].url)"
                                            @error="console.error('Single info image failed to load:', information.images[0].url)"
                                          />
                                          <p
                                            x-show="information.images[0].caption"
                                            class="mt-2 text-xs text-gray-500 italic"
                                            x-text="information.images[0].caption"
                                          ></p>
                                        </div>
                                      </template>

                                      <template x-if="information.images.length > 1">
                                        <div class="relative mt-2" x-data="{ currentSlide: 0 }">
                                          <div
                                            class="swiper rounded-lg"
                                            :id="`swiper-info-${informationId}`"
                                            x-init="$nextTick(() => initializeSwiper(`swiper-info-${informationId}`, getColorHex(subsection.color), (swiper) => { currentSlide = swiper.realIndex; }))"
                                            :style="`--swiper-color: ${getColorHex(subsection.color)}`"
                                          >
                                            <div class="swiper-wrapper">
                                              <template
                                                x-for="image in information.images"
                                                :key="image.url"
                                              >
                                                <div
                                                  class="swiper-slide text-center"
                                                >
                                                  <img
                                                    :data-src="image.url"
                                                    :alt="image.caption || information.title"
                                                    class="h-auto rounded-lg shadow-sm mx-auto swiper-lazy"
                                                    loading="lazy"
                                                    width="400"
                                                    height="225"
                                                    style="
                                                      max-height: 300px;
                                                      max-width: 100%;
                                                      object-fit: contain;
                                                      opacity: 0;
                                                      transition: opacity 0.3s ease;
                                                      aspect-ratio: 16/9;
                                                      background-color: #f3f4f6;
                                                    "
                                                    @load="$event.target.style.opacity='1'; console.log('Info image loaded:', image.url)"
                                                    @error="console.error('Info image failed to load:', image.url)"
                                                  />
                                                  <div class="swiper-lazy-preloader"></div>
                                                </div>
                                              </template>
                                            </div>
                                            <div class="swiper-pagination"></div>
                                            <div class="swiper-button-next"></div>
                                            <div class="swiper-button-prev"></div>
                                          </div>
                                          <!-- Dynamic Carousel Caption -->
                                          <p
                                            x-show="information.images && information.images.length > 0 && information.images[currentSlide] && information.images[currentSlide].caption"
                                            class="text-xs text-gray-500 italic text-center"
                                            x-text="information.images[currentSlide]?.caption"
                                          ></p>
                                        </div>
                                      </template>
                                    </div>
                                  </template>
                                </div>
                              </div>
                            </div>
                          </template>
                        </div>
                      </template>

                      <!-- Mystery Input Field for Subsection -->
                      <template x-if="hasMysteries(subsection.checkboxes)">
                        <div 
                          class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200"
                          role="region"
                          :aria-labelledby="`mystery-label-${subsection.id}`"
                          x-data="{ 
                            mysteryInput: '', 
                            lastUnlock: null,
                            showSuccess: false,
                            showError: false,
                            errorMessage: ''
                          }"
                        >
                          <div class="flex items-center space-x-2 mb-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <span 
                              :id="`mystery-label-${subsection.id}`"
                              class="text-sm font-medium text-gray-700" 
                              x-text="`Discovered a ${getMysteryType(subsection.checkboxes).toLowerCase()} for the first time? Add it below to start tracking it.`"
                            ></span>
                          </div>
                          <div class="flex space-x-2" role="group" :aria-labelledby="`mystery-label-${subsection.id}`">
                            <input
                              type="text"
                              x-model="mysteryInput"
                              @keyup.enter="
                                const result = tryUnlockMystery(mysteryInput, subsection.checkboxes);
                                if (result) {
                                  lastUnlock = result;
                                  showSuccess = true;
                                  showError = false;
                                  mysteryInput = '';
                                  setTimeout(() => showSuccess = false, 3000);
                                } else if (mysteryInput.trim()) {
                                  showError = true;
                                  showSuccess = false;
                                  errorMessage = 'Not a valid unlock keyword. Keep exploring!';
                                  setTimeout(() => showError = false, 3000);
                                }
                              "
                              :placeholder="`Enter a ${getMysteryType(subsection.checkboxes).toLowerCase()}`"
                              :aria-label="`Enter ${getMysteryType(subsection.checkboxes).toLowerCase()} to unlock mystery items`"
                              :aria-describedby="`mystery-help-${subsection.id} ${showSuccess ? 'mystery-success-' + subsection.id : ''} ${showError ? 'mystery-error-' + subsection.id : ''}`"
                              class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent"
                              :style="`focus:ring-color: ${getColorHex(subsection.color)}`"
                            />
                            <button
                              @click="
                                const result = tryUnlockMystery(mysteryInput, subsection.checkboxes);
                                if (result) {
                                  lastUnlock = result;
                                  showSuccess = true;
                                  showError = false;
                                  mysteryInput = '';
                                  setTimeout(() => showSuccess = false, 3000);
                                } else if (mysteryInput.trim()) {
                                  showError = true;
                                  showSuccess = false;
                                  errorMessage = 'Not a valid unlock keyword. Keep exploring!';
                                  setTimeout(() => showError = false, 3000);
                                }
                              "
                              @keydown.enter="$event.target.click()"
                              @keydown.space.prevent="$event.target.click()"
                              class="px-4 py-2 text-sm font-medium text-white rounded-md hover:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-offset-2"
                              :style="`background-color: ${getColorHex(subsection.color)}; focus:ring-color: ${getColorHex(subsection.color)}`"
                              :aria-label="`Try to unlock mystery with entered ${getMysteryType(subsection.checkboxes).toLowerCase()}`"
                            >
                              Try
                            </button>
                          </div>
                          <div :id="`mystery-help-${subsection.id}`" class="sr-only">
                            Enter a keyword you discovered to unlock hidden mystery items in this section
                          </div>
                          
                          <!-- Success Message -->
                          <div 
                            x-show="showSuccess && lastUnlock"
                            x-transition:enter="transition ease-out duration-200"
                            x-transition:enter-start="opacity-0 transform scale-95"
                            x-transition:enter-end="opacity-1 transform scale-100"
                            class="mt-2 p-2 bg-green-50 border border-green-200 rounded-md"
                            :id="`mystery-success-${subsection.id}`"
                            role="status"
                            aria-live="polite"
                          >
                            <div class="flex items-center space-x-2">
                              <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                              <span class="text-sm text-green-800" x-text="`Mystery unlocked: ${lastUnlock?.title}!`"></span>
                            </div>
                          </div>

                          <!-- Error Message -->
                          <div 
                            x-show="showError"
                            x-transition:enter="transition ease-out duration-200"
                            x-transition:enter-start="opacity-0 transform scale-95"
                            x-transition:enter-end="opacity-1 transform scale-100"
                            class="mt-2 p-2 bg-red-50 border border-red-200 rounded-md"
                            :id="`mystery-error-${subsection.id}`"
                            role="alert"
                            aria-live="assertive"
                          >
                            <div class="flex items-center space-x-2">
                              <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                              </svg>
                              <span class="text-sm text-red-800" x-text="errorMessage"></span>
                            </div>
                          </div>
                        </div>
                      </template>

                      <!-- Checkboxes in Subsection -->
                      <div class="space-y-3 mt-4">
                        <template
                          x-for="checkboxId in getVisibleCheckboxes(subsection.checkboxes)"
                          :key="checkboxId"
                        >
                          <div
                            class="checkbox-reveal"
                            x-data="{ checkbox: data.checkboxes[checkboxId], checkboxId: checkboxId }"
                          >
                            <div
                              class="flex items-start space-x-3 p-3 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors bg-white"
                            >
                              <!-- Checkbox -->
                              <input
                                type="checkbox"
                                :id="checkboxId"
                                :checked="checkedItems.includes(checkboxId)"
                                @change="toggleCheckboxWithAnnouncement(checkboxId)"
                                @keydown="handleCheckboxKeydown($event, checkboxId)"
                                class="h-5 w-5 rounded focus:ring-2 checkbox-colored focus:outline-none"
                                :style="`--checkbox-color: ${getColorHex(subsection.color)}; color: ${getColorHex(subsection.color)}; accent-color: ${getColorHex(subsection.color)};`"
                                :aria-describedby="`checkbox-desc-${checkboxId}`"
                                :aria-label="`${getMysteryTitle(checkboxId)} - ${checkedItems.includes(checkboxId) ? 'completed' : 'not completed'}`"
                              />

                              <!-- Content -->
                              <div class="flex-1 min-w-0">
                                <label
                                  :for="checkboxId"
                                  class="block text-sm font-medium text-gray-900 cursor-pointer"
                                  x-text="getMysteryTitle(checkboxId)"
                                ></label>
                                <div :id="`checkbox-desc-${checkboxId}`" class="sr-only">
                                  <span x-text="checkbox.description || 'Checkbox item'"></span>
                                  <span x-show="checkbox.unlockKeyword && !isMysteryUnlocked(checkboxId)"> - Mystery item, click to unlock</span>
                                </div>
                                
                                <!-- Description - only show when checked and mystery content should show -->
                                <template x-if="shouldShowMysteryDescription(checkboxId)">
                                  <p
                                    class="mt-1 text-sm text-gray-600"
                                    x-text="checkbox.description"
                                  ></p>
                                </template>

                                <!-- Hint System - only show for unchecked checkboxes with hints -->
                                <template x-if="shouldShowHints(checkboxId)">
                                  <div class="mt-3">
                                    <!-- Revealed Hints -->
                                    <template x-for="hintText in getRevealedHints(checkboxId)" :key="hintText">
                                      <div class="flex items-start space-x-2 mb-2">
                                        <span class="text-lg" style="opacity: 1.0;">💡</span>
                                        <p class="text-sm text-gray-600 flex-1" x-text="hintText"></p>
                                      </div>
                                    </template>
                                    
                                    <!-- Unrevealed Lightbulbs -->
                                    <template x-if="getUnrevealedLightbulbCount(checkboxId) > 0">
                                      <div class="flex items-center space-x-1 mt-2">
                                        <template x-for="i in getUnrevealedLightbulbCount(checkboxId)" :key="i">
                                          <button
                                            @click="revealNextHint(checkboxId)"
                                            class="text-lg hover:scale-110 transition-transform cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded"
                                            style="opacity: 0.4;"
                                            :title="'Click to get a hint'"
                                            :aria-label="'Reveal next hint for ' + getMysteryTitle(checkboxId)"
                                          >💡</button>
                                        </template>
                                      </div>
                                    </template>
                                  </div>
                                </template>

                                <!-- Images - only show when checked -->
                                <template
                                  x-if="checkedItems.includes(checkboxId) && checkbox.images && checkbox.images.length > 0"
                                >
                                  <div class="mt-3">
                                    <template
                                      x-if="checkbox.images.length === 1"
                                    >
                                      <div class="mt-2 text-center">
                                        <img
                                          :data-src="checkbox.images[0].url"
                                          :alt="checkbox.images[0].caption || checkbox.title"
                                          class="max-w-full h-auto rounded-lg shadow-sm mx-auto"
                                          loading="lazy"
                                          width="400"
                                          height="225"
                                          style="
                                            max-height: 300px;
                                            object-fit: contain;
                                            opacity: 0;
                                            transition: opacity 0.3s ease;
                                            aspect-ratio: 16/9;
                                            background-color: #f3f4f6;
                                          "
                                          @load="$event.target.style.opacity='1'; console.log('Single image loaded:', checkbox.images[0].url)"
                                          @error="console.error('Single image failed to load:', checkbox.images[0].url)"
                                        />
                                        <p
                                          x-show="checkbox.images[0].caption"
                                          class="mt-2 text-xs text-gray-500 italic"
                                          x-text="checkbox.images[0].caption"
                                        ></p>
                                      </div>
                                    </template>

                                    <template x-if="checkbox.images.length > 1">
                                      <div class="relative mt-2" x-data="{ currentSlide: 0 }">
                                        <div
                                          class="swiper rounded-lg"
                                          :id="`swiper-${checkboxId}`"
                                          x-init="$nextTick(() => initializeSwiper(`swiper-${checkboxId}`, getColorHex(subsection.color), (swiper) => { currentSlide = swiper.realIndex; }))"
                                          :style="`--swiper-color: ${getColorHex(subsection.color)}`"
                                        >
                                          <div class="swiper-wrapper">
                                            <template
                                              x-for="image in checkbox.images"
                                              :key="image.url"
                                            >
                                              <div
                                                class="swiper-slide text-center"
                                              >
                                                <img
                                                  :data-src="image.url"
                                                  :alt="image.caption || checkbox.title"
                                                  class="h-auto rounded-lg shadow-sm mx-auto swiper-lazy"
                                                  loading="lazy"
                                                  width="400"
                                                  height="225"
                                                  style="
                                                    max-height: 300px;
                                                    max-width: 100%;
                                                    object-fit: contain;
                                                    opacity: 0;
                                                    transition: opacity 0.3s ease;
                                                    aspect-ratio: 16/9;
                                                    background-color: #f3f4f6;
                                                  "
                                                  @load="$event.target.style.opacity='1'; console.log('Image loaded:', image.url)"
                                                  @error="console.error('Image failed to load:', image.url)"
                                                />
                                                <div class="swiper-lazy-preloader"></div>
                                              </div>
                                            </template>
                                          </div>
                                          <div class="swiper-pagination"></div>
                                          <div class="swiper-button-next"></div>
                                          <div class="swiper-button-prev"></div>
                                        </div>
                                        <!-- Dynamic Carousel Caption -->
                                        <p
                                          x-show="checkbox.images && checkbox.images.length > 0 && checkbox.images[currentSlide] && checkbox.images[currentSlide].caption"
                                          class="text-xs text-gray-500 italic text-center"
                                          x-text="checkbox.images[currentSlide]?.caption"
                                        ></p>
                                      </div>
                                    </template>
                                  </div>
                                </template>
                              </div>
                            </div>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>
                </template>

                <!-- Information Items in Section (Direct) -->
                <template x-if="section.information && getVisibleInformation(section.information).length > 0">
                  <div class="space-y-3">
                    <template
                      x-for="informationId in getVisibleInformation(section.information)"
                      :key="informationId"
                    >
                      <div
                        class="checkbox-reveal"
                        x-data="{ information: data.information[informationId], informationId: informationId }"
                      >
                        <div
                          class="flex items-start space-x-3 p-3 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors bg-white"
                        >
                          <!-- Colored Bullet -->
                          <div 
                            class="mt-1.5 w-2 h-2 rounded-full flex-shrink-0"
                            :style="`background-color: ${getColorHex(section.color)}`"
                          ></div>

                          <!-- Content -->
                          <div class="flex-1 min-w-0">
                            <h4
                              class="block text-sm font-medium text-gray-900"
                              x-text="information.title"
                            ></h4>
                            <p
                              class="mt-1 text-sm text-gray-600"
                              x-text="information.description"
                            ></p>

                            <!-- Images for Information Items -->
                            <template
                              x-if="information.images && information.images.length > 0"
                            >
                              <div class="mt-3">
                                <template
                                  x-if="information.images.length === 1"
                                >
                                  <div class="mt-2 text-center">
                                    <img
                                      :data-src="information.images[0].url"
                                      :alt="information.images[0].caption || information.title"
                                      class="max-w-full h-auto rounded-lg shadow-sm mx-auto"
                                      loading="lazy"
                                      width="400"
                                      height="225"
                                      style="
                                        max-height: 300px;
                                        object-fit: contain;
                                        opacity: 0;
                                        transition: opacity 0.3s ease;
                                        aspect-ratio: 16/9;
                                        background-color: #f3f4f6;
                                      "
                                      @load="$event.target.style.opacity='1'; console.log('Single info image loaded:', information.images[0].url)"
                                      @error="console.error('Single info image failed to load:', information.images[0].url)"
                                    />
                                    <p
                                      x-show="information.images[0].caption"
                                      class="mt-2 text-xs text-gray-500 italic"
                                      x-text="information.images[0].caption"
                                    ></p>
                                  </div>
                                </template>

                                <template x-if="information.images.length > 1">
                                  <div class="relative mt-2" x-data="{ currentSlide: 0 }">
                                    <div
                                      class="swiper rounded-lg"
                                      :id="`swiper-info-${informationId}`"
                                      x-init="$nextTick(() => initializeSwiper(`swiper-info-${informationId}`, getColorHex(section.color), (swiper) => { currentSlide = swiper.realIndex; }))"
                                      :style="`--swiper-color: ${getColorHex(section.color)}`"
                                    >
                                      <div class="swiper-wrapper">
                                        <template
                                          x-for="image in information.images"
                                          :key="image.url"
                                        >
                                          <div
                                            class="swiper-slide text-center"
                                          >
                                            <img
                                              :data-src="image.url"
                                              :alt="image.caption || information.title"
                                              class="h-auto rounded-lg shadow-sm mx-auto swiper-lazy"
                                              loading="lazy"
                                              width="400"
                                              height="225"
                                              style="
                                                max-height: 300px;
                                                max-width: 100%;
                                                object-fit: contain;
                                                opacity: 0;
                                                transition: opacity 0.3s ease;
                                                aspect-ratio: 16/9;
                                                background-color: #f3f4f6;
                                              "
                                              @load="$event.target.style.opacity='1'; console.log('Info image loaded:', image.url)"
                                              @error="console.error('Info image failed to load:', image.url)"
                                            />
                                            <div class="swiper-lazy-preloader"></div>
                                          </div>
                                        </template>
                                      </div>
                                      <div class="swiper-pagination"></div>
                                      <div class="swiper-button-next"></div>
                                      <div class="swiper-button-prev"></div>
                                    </div>
                                    <!-- Dynamic Carousel Caption -->
                                    <p
                                      x-show="information.images && information.images.length > 0 && information.images[currentSlide] && information.images[currentSlide].caption"
                                      class="text-xs text-gray-500 italic text-center"
                                      x-text="information.images[currentSlide]?.caption"
                                    ></p>
                                  </div>
                                </template>
                              </div>
                            </template>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </template>

                <!-- Mystery Input Field for Section (Direct Checkboxes) -->
                <template x-if="hasMysteries(section.checkboxes)">
                  <div 
                    class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200"
                    x-data="{ 
                      mysteryInput: '', 
                      lastUnlock: null,
                      showSuccess: false,
                      showError: false,
                      errorMessage: ''
                    }"
                  >
                    <div class="flex items-center space-x-2 mb-2">
                      <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                      </svg>
                      <span class="text-sm font-medium text-gray-700" x-text="`Discovered a ${getMysteryType(section.checkboxes).toLowerCase()} for the first time? Add it below to start tracking it.`"></span>
                    </div>
                    <div class="flex space-x-2">
                      <input
                        type="text"
                        x-model="mysteryInput"
                        @keyup.enter="
                          const result = tryUnlockMystery(mysteryInput, section.checkboxes);
                          if (result) {
                            lastUnlock = result;
                            showSuccess = true;
                            showError = false;
                            mysteryInput = '';
                            setTimeout(() => showSuccess = false, 3000);
                          } else if (mysteryInput.trim()) {
                            showError = true;
                            showSuccess = false;
                            errorMessage = 'Not a valid unlock keyword. Keep exploring!';
                            setTimeout(() => showError = false, 3000);
                          }
                        "
                        :placeholder="`Enter a ${getMysteryType(section.checkboxes).toLowerCase()}`"
                        class="flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent"
                        :style="`focus:ring-color: ${getColorHex(section.color)}`"
                      />
                      <button
                        @click="
                          const result = tryUnlockMystery(mysteryInput, section.checkboxes);
                          if (result) {
                            lastUnlock = result;
                            showSuccess = true;
                            showError = false;
                            mysteryInput = '';
                            setTimeout(() => showSuccess = false, 3000);
                          } else if (mysteryInput.trim()) {
                            showError = true;
                            showSuccess = false;
                            errorMessage = 'Not a valid unlock keyword. Keep exploring!';
                            setTimeout(() => showError = false, 3000);
                          }
                        "
                        class="px-4 py-2 text-sm font-medium text-white rounded-md hover:opacity-90 transition-opacity"
                        :style="`background-color: ${getColorHex(section.color)}`"
                      >
                        Try
                      </button>
                    </div>
                    
                    <!-- Success Message -->
                    <div 
                      x-show="showSuccess && lastUnlock"
                      x-transition:enter="transition ease-out duration-200"
                      x-transition:enter-start="opacity-0 transform scale-95"
                      x-transition:enter-end="opacity-1 transform scale-100"
                      class="mt-2 p-2 bg-green-50 border border-green-200 rounded-md"
                    >
                      <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm text-green-800" x-text="`Mystery unlocked: ${lastUnlock?.title}!`"></span>
                      </div>
                    </div>

                    <!-- Error Message -->
                    <div 
                      x-show="showError"
                      x-transition:enter="transition ease-out duration-200"
                      x-transition:enter-start="opacity-0 transform scale-95"
                      x-transition:enter-end="opacity-1 transform scale-100"
                      class="mt-2 p-2 bg-red-50 border border-red-200 rounded-md"
                    >
                      <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <span class="text-sm text-red-800" x-text="errorMessage"></span>
                      </div>
                    </div>
                  </div>
                </template>

                <!-- Direct checkboxes in section (no subsection) -->
                <template
                  x-if="section.checkboxes && section.checkboxes.length > 0"
                >
                  <div class="space-y-3">
                    <template
                      x-for="checkboxId in getVisibleCheckboxes(section.checkboxes)"
                      :key="checkboxId"
                    >
                      <div
                        class="checkbox-reveal"
                        x-data="{ checkbox: data.checkboxes[checkboxId], checkboxId: checkboxId }"
                      >
                        <div
                          class="flex items-start space-x-3 p-3 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors bg-white"
                        >
                          <!-- Checkbox -->
                          <input
                            type="checkbox"
                           :id="checkboxId"
                            :checked="checkedItems.includes(checkboxId)"
                            @change="toggleCheckbox(checkboxId)"
                            class="h-5 w-5 rounded focus:ring-2 checkbox-colored"
                            :style="`--checkbox-color: ${getColorHex(section.color)}; color: ${getColorHex(section.color)}; accent-color: ${getColorHex(section.color)};`"
                          />

                          <!-- Content -->
                          <div class="flex-1 min-w-0">
                            <label
                              :for="checkboxId"
                              class="block text-sm font-medium text-gray-900 cursor-pointer"
                              x-text="getMysteryTitle(checkboxId)"
                            ></label>
                            
                            <!-- Description - only show when checked and mystery content should show -->
                            <template x-if="shouldShowMysteryDescription(checkboxId)">
                              <p
                                class="mt-1 text-sm text-gray-600"
                                x-text="checkbox.description"
                              ></p>
                            </template>

                            <!-- Hint System - only show for unchecked checkboxes with hints -->
                            <template x-if="shouldShowHints(checkboxId)">
                              <div class="mt-3">
                                <!-- Revealed Hints -->
                                <template x-for="hintText in getRevealedHints(checkboxId)" :key="hintText">
                                  <div class="flex items-start space-x-2 mb-2">
                                    <span class="text-lg" style="opacity: 1.0;">💡</span>
                                    <p class="text-sm text-gray-600 flex-1" x-text="hintText"></p>
                                  </div>
                                </template>
                                
                                <!-- Unrevealed Lightbulbs -->
                                <template x-if="getUnrevealedLightbulbCount(checkboxId) > 0">
                                  <div class="flex items-center space-x-1 mt-2">
                                    <template x-for="i in getUnrevealedLightbulbCount(checkboxId)" :key="i">
                                      <button
                                        @click="revealNextHint(checkboxId)"
                                        class="text-lg hover:scale-110 transition-transform cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded"
                                        style="opacity: 0.4;"
                                        :title="'Click to get a hint'"
                                        :aria-label="'Reveal next hint for ' + getMysteryTitle(checkboxId)"
                                      >💡</button>
                                    </template>
                                  </div>
                                </template>
                              </div>
                            </template>

                            <!-- Images - only show when checked and mystery content should show -->
                            <template
                              x-if="shouldShowMysteryDescription(checkboxId) && checkbox.images && checkbox.images.length > 0"
                            >
                              <div class="mt-3">
                                <template
                                  x-if="checkbox.images.length === 1"
                                >
                                  <div class="mt-2 text-center">
                                    <img
                                      :data-src="checkbox.images[0].url"
                                      :alt="checkbox.images[0].caption || checkbox.title"
                                      class="max-w-full h-auto rounded-lg shadow-sm mx-auto"
                                      loading="lazy"
                                      width="400"
                                      height="225"
                                      style="
                                        max-height: 300px;
                                        object-fit: contain;
                                        opacity: 0;
                                        transition: opacity 0.3s ease;
                                        aspect-ratio: 16/9;
                                        background-color: #f3f4f6;
                                      "
                                      @load="$event.target.style.opacity='1'; console.log('Single image loaded:', checkbox.images[0].url)"
                                      @error="console.error('Single image failed to load:', checkbox.images[0].url)"
                                    />
                                    <p
                                      x-show="checkbox.images[0].caption"
                                      class="mt-2 text-xs text-gray-500 italic"
                                      x-text="checkbox.images[0].caption"
                                    ></p>
                                  </div>
                                </template>

                                <template x-if="checkbox.images.length > 1">
                                  <div class="relative mt-2" x-data="{ currentSlide: 0 }">
                                    <div
                                      class="swiper rounded-lg"
                                      :id="`swiper-${checkboxId}`"
                                      x-init="$nextTick(() => initializeSwiper(`swiper-${checkboxId}`, getColorHex(section.color), (swiper) => { currentSlide = swiper.realIndex; }))"
                                      :style="`--swiper-color: ${getColorHex(section.color)}`"
                                    >
                                      <div class="swiper-wrapper">
                                        <template
                                          x-for="image in checkbox.images"
                                          :key="image.url"
                                        >
                                          <div
                                            class="swiper-slide text-center"
                                          >
                                            <img
                                              :data-src="image.url"
                                              :alt="image.caption || checkbox.title"
                                              class="h-auto rounded-lg shadow-sm mx-auto swiper-lazy"
                                              loading="lazy"
                                              width="400"
                                              height="225"
                                              style="
                                                max-height: 300px;
                                                max-width: 100%;
                                                object-fit: contain;
                                                opacity: 0;
                                                transition: opacity 0.3s ease;
                                                aspect-ratio: 16/9;
                                                background-color: #f3f4f6;
                                              "
                                              @load="$event.target.style.opacity='1'; console.log('Image loaded:', image.url)"
                                              @error="console.error('Image failed to load:', image.url)"
                                            />
                                            <div class="swiper-lazy-preloader"></div>
                                          </div>
                                        </template>
                                      </div>
                                      <div class="swiper-pagination"></div>
                                      <div class="swiper-button-next"></div>
                                      <div class="swiper-button-prev"></div>
                                    </div>
                                    <!-- Dynamic Carousel Caption -->
                                    <p
                                      x-show="checkbox.images && checkbox.images.length > 0 && checkbox.images[currentSlide] && checkbox.images[currentSlide].caption"
                                      class="text-xs text-gray-500 italic text-center"
                                      x-text="checkbox.images[currentSlide]?.caption"
                                    ></p>
                                  </div>
                                </template>
                              </div>
                            </template>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </template>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>

    <script src="sections.js"></script>
    <script src="checkboxes.js"></script>
    <script src="information.js"></script>
    <script src="data.js"></script>
    <script src="app.js"></script>
  </body>
</html>
